Object.defineProperty(exports,"__esModule",{value:!0}),exports.Gmap=a,exports.GmapDOM=void 0;var n=function(n){if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{default:n};var t=o();if(t&&t.has(n))return t.get(n);var r={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var u=e?Object.getOwnPropertyDescriptor(n,i):null;u&&(u.get||u.set)?Object.defineProperty(r,i,u):r[i]=n[i]}r.default=n,t&&t.set(n,r);return r}(require("react")),t=i(require("react-dom")),r=i(require("./assets/images/geo-icon.png")),e=i(require("./lib"));function i(n){return n&&n.__esModule?n:{default:n}}function o(){if("function"!=typeof WeakMap)return null;var n=new WeakMap;return o=function(){return n},n}function u(){return(u=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}function a(t){var i=(0,n.useState)(),o=i[0],a=i[1],c=(0,n.useState)([]),f=c[0],l=c[1],v=function(t){void 0===t&&(t=!1);var r=(0,n.useState)(),e=r[0],i=r[1],o=(0,n.useState)(),u=o[0],a=o[1];return(0,n.useEffect)((function(){var n=navigator.geolocation.watchPosition(i,a,{enableHighAccuracy:t,timeout:5e3});return function(){return navigator.geolocation.clearWatch(n)}}),[]),[e,u]}(!0),s=v[0],d=v[1],p=(0,n.useState)({}),g=p[0],b=p[1],m=(0,n.useRef)();(0,n.useEffect)((function(){(0,e.default)(t.mapKey).then((function(n){n.createMap(m.current,{zoom:18,center:t.center||{lat:0,lng:0},clickableIcons:!1,disableDefaultUI:!0}),a(n)}))}),[]),(0,n.useEffect)((function(){if(o){var n=function(n){var t=void 0===n?{}:n,r=t.googleMap,e=t.markers,i=void 0===e?[]:e,o=t.propsMarkers,u=void 0===o?[]:o;return r?(i.forEach((function(n){n.marker.setMap(null)})),u.forEach((function(n,t){var e=i[t];e?(e.marker.setPosition({lat:n.lat,lng:n.lng}),e.marker.setMap(r.getMap())):i.push({marker:r.createMarker({icon:n.icon,position:{lat:n.lat,lng:n.lng}}),info:r.createInfoWindow({content:"<div>"+n.info+"</div>"})})})),i):i}({googleMap:o,markers:f,propsMarkers:t.markers});l(n),o.createBound(t.markers)}}),[o,t.markers]),(0,n.useEffect)((function(){o&&f.map((function(n,r){t.markers[r]&&t.markers[r].showInfo?n.info.open(o,n.marker):n.info.close()}))}),[o,t.markers,f]),(0,n.useEffect)((function(){!function(){if(!o||!t.showGeoLocation||!s||d)return console.log("HELLO 1",s,d),void(g.marker&&g.marker.setMap(null));console.log("HELLO 2"),g.marker=g.marker||o.createMarker({position:{lat:0,lng:0}}),g.marker.setMap(o.getMap()),g.marker.setPosition({lat:s.coords.latitude,lng:s.coords.longitude}),b(g)}()}),[o,t.showGeoLocation,s,d]);var O=(0,n.useCallback)((function(){o&&t.showGeoLocation&&s&&!d&&o.getMap().setCenter({lat:s.coords.latitude,lng:s.coords.longitude})}),[o,t.showGeoLocation,s,d]);return n.default.createElement("div",{className:"map-container",style:u({},t.style,{position:"relative"})},n.default.createElement("div",{ref:m,id:"map",style:{width:"100%",height:"100%"}}),t.showGeoLocation&&n.default.createElement("span",{id:"geo-btn",style:{position:"absolute",top:8,right:8,lineHeight:0,padding:8},onClick:O},n.default.createElement("img",{src:r.default,width:32})))}a.defaultProps={markers:[],routes:[]};var c=[],f={render:function(r,e){var i=n.default.createElement(a,r);return c.push(i),t.default.render(i,e),i},unmount:function(n){t.default.unmountComponentAtNode(n)},unmountAll:function(){c.forEach((function(n){return t.default.unmountComponentAtNode(n)})),c=[]}};exports.GmapDOM=f;